<% layout("layouts/bolierplate") %>

  <div class="container">
    <div class="listing-header">
      <h2 class="page-title">Listing Details</h2>
      <a href="/listings" class="back-link">← Back to Listings</a>
    </div>

    <div class="listing-detail-card">
      <div class="listing-image-container">
        <% if ((typeof listing.image==="string" && listing.image.trim() !=="" ) || (listing.image && listing.image.url))
          { %>
          <img src="<%= listing.image.url || listing.image %>" alt="<%= listing.title %>" class="listing-image" />
          <% } else { %>
            <div class="no-image-placeholder">
              <span>📷 No Image Available</span>
            </div>
            <% } %>

      </div>

      <div class="listing-content">
        <h3 class="listing-title">
          <%= listing.title %>
        </h3>

        <div class="listing-info">
          <div class="info-item">
            <span class="info-label">Description:</span>
            <p class="info-value">
              <%= listing.description %>
            </p>
          </div>

          <div class="info-item">
            <span class="info-label">Price:</span>
            <p class="info-value price-highlight">₹<%= listing.price.toLocaleString("en-IN") %>
            </p>
          </div>

          <div class="info-item">
            <span class="info-label">Location:</span>
            <p class="info-value">📍 <%= listing.location %>, <%= listing.country %>
            </p>
          </div>
        </div>

        <div class="listing-actions">
          <a href="/listings/<%= listing._id %>/edit" class="action-button edit-button">
            ✏️ Edit Listing
          </a>

          <form method="POST" action="/listings/<%= listing._id %>?_method=DELETE"
            onsubmit="return confirm('Are you sure you want to delete this listing?');" class="delete-form">
            <button type="submit" class="action-button delete-button">
              🗑️ Delete Listing
            </button>
          </form>
        </div>
        <div class="listing-header">
          <h4>Leave a review</h4>
          <form action="/listings/<%= listing.id%>/reviews" method="POST">
            <div>
              <label for="rating">Rating</label>
              <input type="range" min="1" max="5" id="rating" name="review[rating]">
            </div>
            <div>
              <label for="comment">comments</label>
              <textarea name="review[comment]" id="comment" cols="30" rows="5"></textarea>
            </div>
            <button>Sumbit</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  // Add this to your show.ejs file
<script>
document.addEventListener('DOMContentLoaded', function() {
    const ratingSlider = document.getElementById('rating');
    const ratingDisplay = document.createElement('div');
    ratingDisplay.className = 'rating-display';
    
    function updateRating(value) {
        const stars = '★'.repeat(value) + '☆'.repeat(5 - value);
        ratingDisplay.innerHTML = `
            <span class="rating-value">${value}/5</span>
            <div class="rating-stars">${stars}</div>
        `;
    }
    
    ratingSlider.addEventListener('input', function() {
        updateRating(this.value);
    });
    
    ratingSlider.parentNode.appendChild(ratingDisplay);
    updateRating(ratingSlider.value || 3);
});
</script>